(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{9166:function(e,t,s){Promise.resolve().then(s.bind(s,6284))},6284:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),a=s(2265),n=s(5243),i=s(2593),l=s(3113),o=s(4743),c=s(5526);function d(e){let{onPostCreated:t}=e,[s,n]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),f=async()=>{if(s.trim()||m){u(!0);try{let{data:{user:e}}=await c.O.auth.getUser();if(!e)throw Error("Not authenticated");let r=null;if(m){let t=m.name.split(".").pop(),s="".concat(e.id,"-").concat(Math.random(),".").concat(t),{error:a}=await c.O.storage.from("post-images").upload(s,m);if(a)throw a;let{data:{publicUrl:n}}=c.O.storage.from("post-images").getPublicUrl(s);r=n}let{error:a}=await c.O.from("posts").insert({content:s,user_id:e.id,image_url:r});if(a)throw a;n(""),x(null),p(null),t&&t()}catch(e){console.error("Error creating post:",e),alert("Failed to create post")}finally{u(!1)}}};return(0,r.jsx)(i.default,{className:"mb-8 p-4",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("textarea",{value:s,onChange:e=>n(e.target.value),placeholder:"What's happening on campus?",className:"w-full bg-transparent border-none focus:ring-0 resize-none text-text-main placeholder-text-muted min-h-[80px]"}),h&&(0,r.jsxs)("div",{className:"relative mt-2 mb-2 w-full h-48 rounded-xl overflow-hidden group",children:[(0,r.jsx)("img",{src:h,alt:"Preview",className:"w-full h-full object-cover"}),(0,r.jsx)("button",{onClick:()=>{x(null),p(null)},className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,r.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-white/10",children:[(0,r.jsxs)("label",{className:"p-2 text-text-secondary hover:text-primary transition-colors rounded-full hover:bg-primary/5 cursor-pointer",children:[(0,r.jsx)(l.Z,{size:20}),(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];x(t),p(URL.createObjectURL(t))}}})]}),(0,r.jsxs)("button",{onClick:f,disabled:d||!s.trim()&&!m,className:"px-4 py-2 bg-primary text-white rounded-full font-medium text-sm hover:bg-primary-hover transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)("span",{children:d?"Posting...":"Post"}),(0,r.jsx)(o.Z,{size:14})]})]})]})]})})}var u=s(6297),m=s(1235);function x(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(!0),[l,o]=(0,a.useState)(null),[x,h]=(0,a.useState)(new Set),p=async()=>{try{let{data:{user:e}}=await c.O.auth.getUser();o(e);let{data:s,error:r}=await c.O.from("posts").select("\n          *,\n          profiles (\n            full_name,\n            avatar_url\n          )\n        ").order("created_at",{ascending:!1});if(r)throw r;if(t(s||[]),e){let{data:t}=await c.O.from("post_likes").select("post_id").eq("user_id",e.id);t&&h(new Set(t.map(e=>e.post_id)))}}catch(e){console.error("Error fetching posts:",e)}finally{i(!1)}};return(0,a.useEffect)(()=>{p();let e=c.O.channel("realtime posts").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},e=>{p()}).subscribe();return()=>{c.O.removeChannel(e)}},[]),(0,r.jsxs)("main",{className:"min-h-screen p-4 md:p-8 relative",children:[(0,r.jsx)(n.default,{}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Town Square"}),(0,r.jsx)("p",{className:"text-text-secondary",children:"What's happening on campus right now."})]}),(0,r.jsx)(d,{onPostCreated:p}),s?(0,r.jsx)("div",{className:"columns-1 md:columns-2 gap-6 space-y-6",children:[1,2,3,4].map(e=>(0,r.jsx)("div",{className:"break-inside-avoid mb-6",children:(0,r.jsxs)("div",{className:"p-4 rounded-2xl bg-surface/70 backdrop-blur-md border border-white/20 shadow-glass",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)(m.O,{className:"h-10 w-10 rounded-full"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(m.O,{className:"h-4 w-32"}),(0,r.jsx)(m.O,{className:"h-3 w-20"})]})]}),(0,r.jsx)(m.O,{className:"h-20 w-full mb-4"}),(0,r.jsx)(m.O,{className:"h-64 w-full rounded-xl"})]})},e))}):(0,r.jsx)("div",{className:"columns-1 md:columns-2 gap-6 space-y-6",children:e.map(e=>{var t,s,a;return(0,r.jsx)("div",{className:"break-inside-avoid mb-6",children:(0,r.jsx)(u.Z,{post:{id:e.id,author:{name:(null===(t=e.profiles)||void 0===t?void 0:t.full_name)||"Anonymous",avatar:(null===(s=e.profiles)||void 0===s?void 0:s.avatar_url)||"https://api.dicebear.com/7.x/initials/svg?seed=".concat(null===(a=e.profiles)||void 0===a?void 0:a.full_name),time:new Date(e.created_at).toLocaleDateString()},content:e.content,image:e.image_url,likes:e.likes_count||0,comments:e.comments_count||0,isLiked:x.has(e.id),currentUserId:null==l?void 0:l.id}})},e.id)})})]})]})}},6297:function(e,t,s){"use strict";s.d(t,{Z:function(){return h}});var r=s(7437),a=s(2265),n=s(8614),i=s(521),l=s(2593),o=s(7782),c=s(8997),d=s(2718),u=s(8919),m=s(4743),x=s(5526);function h(e){let{post:t}=e,[s,h]=(0,a.useState)(t.likes),[p,f]=(0,a.useState)(t.isLiked||!1),[v,g]=(0,a.useState)(!1),[b,j]=(0,a.useState)([]),[w,N]=(0,a.useState)(""),[y,_]=(0,a.useState)(!1),k=async()=>{if(!t.currentUserId)return;let e=!p;f(e),h(t=>e?t+1:t-1);try{e?(await x.O.from("post_likes").insert({user_id:t.currentUserId,post_id:t.id}),await x.O.rpc("increment_likes",{row_id:t.id})):(await x.O.from("post_likes").delete().match({user_id:t.currentUserId,post_id:t.id}),await x.O.rpc("decrement_likes",{row_id:t.id}))}catch(t){console.error("Error toggling like:",t),f(!e),h(t=>e?t-1:t+1)}},O=async()=>{if(v){g(!1);return}_(!0),g(!0);try{let{data:e}=await x.O.from("comments").select("*, profiles(full_name, avatar_url)").eq("post_id",t.id).order("created_at",{ascending:!0});j(e||[])}catch(e){console.error("Error fetching comments:",e)}finally{_(!1)}},I=async()=>{if(!w.trim()||!t.currentUserId)return;let e={id:crypto.randomUUID(),content:w,user_id:t.currentUserId,created_at:new Date().toISOString(),profiles:{full_name:"You",avatar_url:null}};j(t=>[...t,e]),N("");try{await x.O.from("comments").insert({content:e.content,post_id:t.id,user_id:t.currentUserId}),await x.O.rpc("increment_comments",{row_id:t.id})}catch(e){console.error("Error adding comment:",e)}};return(0,r.jsxs)(l.default,{className:"mb-6 p-0 overflow-hidden group",children:[(0,r.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden",children:(0,r.jsx)("img",{src:t.author.avatar,alt:t.author.name,className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold text-text-main text-sm",children:t.author.name}),(0,r.jsx)("p",{className:"text-xs text-text-secondary",children:t.author.time})]})]}),(0,r.jsx)("button",{className:"text-text-secondary hover:text-text-main transition-colors",children:(0,r.jsx)(o.Z,{size:20})})]}),(0,r.jsx)("div",{className:"px-4 pb-2",children:(0,r.jsx)("p",{className:"text-text-main leading-relaxed mb-4",children:t.content})}),t.image&&(0,r.jsx)("div",{className:"w-full h-64 bg-gray-100 overflow-hidden",children:(0,r.jsx)("img",{src:t.image,alt:"Post content",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})}),(0,r.jsxs)("div",{className:"p-4 flex items-center justify-between border-t border-white/10 bg-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)("button",{onClick:k,className:"flex items-center gap-2 transition-colors group/like ".concat(p?"text-red-500":"text-text-secondary hover:text-primary"),children:[(0,r.jsx)("div",{className:"p-2 rounded-full transition-colors ".concat(p?"bg-red-500/10":"group-hover/like:bg-primary/10"),children:(0,r.jsx)(c.Z,{size:20,className:"transition-transform ".concat(p?"fill-current scale-110":"group-hover/like:scale-110")})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:s})]}),(0,r.jsxs)("button",{onClick:O,className:"flex items-center gap-2 transition-colors group/comment ".concat(v?"text-primary":"text-text-secondary hover:text-secondary"),children:[(0,r.jsx)("div",{className:"p-2 rounded-full group-hover/comment:bg-secondary/10 transition-colors",children:(0,r.jsx)(d.Z,{size:20})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:t.comments+b.length})]})]}),(0,r.jsx)("button",{className:"text-text-secondary hover:text-text-main transition-colors p-2 hover:bg-white/10 rounded-full",children:(0,r.jsx)(u.Z,{size:20})})]}),(0,r.jsx)(n.M,{children:v&&(0,r.jsx)(i.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-white/10 bg-black/20",children:(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[y?(0,r.jsx)("p",{className:"text-center text-sm text-text-secondary",children:"Loading comments..."}):b.length>0?(0,r.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2",children:b.map(e=>{var t,s,a;return(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 overflow-hidden flex-shrink-0",children:(0,r.jsx)("img",{src:(null===(t=e.profiles)||void 0===t?void 0:t.avatar_url)||"https://api.dicebear.com/7.x/initials/svg?seed=".concat(null===(s=e.profiles)||void 0===s?void 0:s.full_name),alt:"Avatar",className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:"flex-1 bg-white/5 rounded-2xl rounded-tl-none p-3",children:[(0,r.jsx)("p",{className:"text-xs font-bold text-text-main mb-1",children:null===(a=e.profiles)||void 0===a?void 0:a.full_name}),(0,r.jsx)("p",{className:"text-sm text-text-secondary",children:e.content})]})]},e.id)})}):(0,r.jsx)("p",{className:"text-center text-sm text-text-secondary py-2",children:"No comments yet. Be the first!"}),(0,r.jsxs)("div",{className:"flex gap-2 items-center pt-2",children:[(0,r.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),placeholder:"Write a comment...",className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm text-text-main focus:outline-none focus:border-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&I()}),(0,r.jsx)("button",{onClick:I,disabled:!w.trim(),className:"p-2 bg-primary text-white rounded-full hover:bg-primary-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(m.Z,{size:16})})]})]})})})]})}},5243:function(e,t,s){"use strict";s.d(t,{default:function(){return n}});var r=s(7437),a=s(521);function n(){return(0,r.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,r.jsx)(a.E.div,{animate:{x:[0,100,0],y:[0,-50,0],scale:[1,1.2,1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"},className:"absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-primary/10 rounded-full blur-[100px]"}),(0,r.jsx)(a.E.div,{animate:{x:[0,-100,0],y:[0,100,0],scale:[1,1.5,1]},transition:{duration:25,repeat:1/0,ease:"easeInOut",delay:2},className:"absolute top-[20%] right-[-10%] w-[40vw] h-[40vw] bg-secondary/10 rounded-full blur-[120px]"}),(0,r.jsx)(a.E.div,{animate:{x:[0,50,0],y:[0,50,0],scale:[1,1.1,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut",delay:5},className:"absolute bottom-[-10%] left-[20%] w-[60vw] h-[60vw] bg-primary-light/20 rounded-full blur-[100px]"})]})}},2593:function(e,t,s){"use strict";s.d(t,{default:function(){return n}});var r=s(7437),a=s(521);function n(e){let{children:t,className:s,hoverEffect:n=!0,...i}=e;return(0,r.jsx)(a.E.div,{whileHover:n?{y:-5,scale:1.01}:{},transition:{type:"spring",stiffness:300,damping:20},className:"\n        relative overflow-hidden\n        bg-surface/70 backdrop-blur-md\n        border border-white/20\n        shadow-glass\n        rounded-2xl\n        ".concat(s||"","\n      "),...i,children:(0,r.jsx)("div",{className:"relative z-10",children:t})})}},1235:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var r=s(7437),a=s(3448);function n(e){let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-white/10",t),...s})}},5526:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});let r=(0,s(2577).createBrowserClient)("https://agakkvodhqinapxsqfou.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnYWtrdm9kaHFpbmFweHNxZm91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODU1NDYsImV4cCI6MjA4MDM2MTU0Nn0.n5bhFCiK8bOwsUnZyjsLwxE_kv0NV4DScT6tHFAAFH8")},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var r=s(1994),a=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}}},function(e){e.O(0,[521,577,137,445,971,117,744],function(){return e(e.s=9166)}),_N_E=e.O()}]);